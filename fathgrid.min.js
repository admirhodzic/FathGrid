var style=document.createElement("style");style.setAttribute("id","FathGrid_styles"),style.innerHTML='\n  .fathgrid-wrapper .fathgrid thead th {padding:0.5em 1.5em;}  \n  .fathgrid-wrapper .fathgrid thead th.sorted, th.sorted-desc {position: relative;}\n  .fathgrid-wrapper .fathgrid thead th.sorted::after {content:"▲";position:absolute;right: 0.4em;}\n  .fathgrid-wrapper[dir=rtl] .fathgrid thead th.sorted::after {right:auto;left: 0.4em;}\n  .fathgrid-wrapper .fathgrid thead th.sorted-desc::after {content:"▼";position:absolute;right: 0.4em;}\n  .fathgrid-wrapper[dir=rtl] .fathgrid thead th.sorted-desc::after {right:auto;left: 0.4em;}\n  .fathgrid-wrapper .fathgrid-export-nav, .fathgrid-wrapper .fathgrid-columns-nav, .fathgrid-wrapper .fathgrid-graph-nav, .fathgrid-wrapper .fathgrid-print-nav {float:right;}\n  .fathgrid-wrapper[dir=rtl] .fathgrid-export-nav, .fathgrid-wrapper[dir=rtl] .fathgrid-columns-nav, .fathgrid-wrapper[dir=rtl] .fathgrid-graph-nav, .fathgrid-wrapper[dir=rtl] .fathgrid-print-nav {float:left;}\n  .fathgrid-wrapper {position:relative;}\n  .fathgrid-wrapper .page-info {}\n  \n  .fathgrid-wrapper .dropdown {    position: relative;    display: inline-block;  }\n  .fathgrid-wrapper .dropdown-content {\n    display: none;\n    position: absolute;\n    right:0;\n    background-color: #f9f9f9;\n    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);\n    z-index: 1;\n  }\n  \n  .fathgrid-wrapper .dropdown:hover .dropdown-content {    display: block;  }  \n  .fathgrid-wrapper .dropdown:hover .dropdown-content a {display:block;padding:0.1em 2em;margin:2px 0;}\n  .fathgrid-wrapper .dropdown:hover .dropdown-content a:hover {background-color:#eee;}\n  .fathgrid-wrapper .error {border-color:red;}\n\n  .fathgrid-wrapper input, .fathgrid-wrapper textarea , .fathgrid-wrapper select {border:0;}\n\n  .fathgrid-wrapper nav a.checked::before{content:\'✓\';position:absolute;left:1em;}  \n  .fathgrid-wrapper[dir=rtl] nav a.checked::before{left:auto;right:1em;}  \n\n  .fathgrid-wrapper .pagination {\n    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n    display: flex;\n    list-style:none;\n    padding-inline-start:0;\n  }\n  .fathgrid-wrapper .page-link:not(.gotopage):hover {  background:#eee;}\n  .fathgrid-wrapper .page-link {\n    position: relative;\n    color: #007bff;\n    display: block;\n    padding: 4px 8px;\n    margin-left: -1px;\n    line-height: 1.4em;\n    border: 1px solid #ddd;\n    text-decoration:none;\n  }\n  \n  .fathgrid-wrapper .graphplaceholder  {background:white;display:none;transition-duration:0.4s;width:100%;border:solid 1px #bbb;margin:15px 0;padding:1em;}\n  \n  .fathgrid-wrapper nav.active {background:#bcf;}\n\n\n  .fathgrid-wrapper[dir=ltr] tr.selected td:nth-child(1) {border-left:solid 4px cornflowerblue;}\n  .fathgrid-wrapper[dir=rtl] tr.selected td:nth-child(1) {border-right:solid 4px cornflowerblue;}\n  tr.selected > td{background:#ddd;}\n\n',document.head.appendChild(style),function(win){win.FathGrid=function(id,_config){var config={id:id,size:20,page:1,multiselect:!1,editable:!1,filterable:!0,sortable:!0,pageable:!0,exportable:!0,printable:!0,graphType:"line",graphValues:this.undefined,showFooter:!1,selectColumns:!1,showGroupFooter:!1,onInitFilter:function(el){},onInitTable:function(el){},onInitInput:function(item,idx,el){},prepareData:async function(data){return data},sort:[],columns:[],onRender:function(){},onClick:function(data,col,el){editCell(data.rownum,col)},onChange:function(data,col,old,value){},rowClass:null,data:null,q:"",rtl:!1,decimals:2,graphHeight:"200px",template:"{tools}{info}{graph}{table}{pager}",language:"auto",..._config},langs={en:{of:"of",yes:"yes",export:"Export",previous:"Previous",next:"Next",last:"Last",first:"First",gotoPage:"Goto Page",loading:"Loading...",selectRow:"Select Row",showSelectedOnly:"Show Only Selected Rows"},de:{of:"von",yes:"Ja",export:"Export",previous:"Bisherige",next:"Nächster",last:"Zuletzt",first:"Zuerst",gotoPage:"gehe zu Seite",loading:"Wird geladen...",selectRow:"Zeile auswählen",showSelectedOnly:"Nur ausgewählte Zeilen anzeigen"},fr:{of:"de",yes:"Oui",export:"exportation",previous:"précédent",next:"suivant",last:"dernier",first:"première",gotoPage:"aller à la page",loading:"chargement...",selectRow:"sélectionner la ligne",showSelectedOnly:"afficher uniquement les lignes sélectionnées"},ar:{of:"من",yes:"نعم",export:"تصدير",previous:"السابق",next:"التالى",last:"الاخير",first:"أول",gotoPage:"انتقل إلى صفحة",loading:"جار التحميل",selectRow:"حدد الصف",showSelectedOnly:"إظهار الصفوف المحددة فقط"},es:{of:"de",yes:"si",export:"exportat",previous:"anterior",next:"próximo",last:"último",first:"primero",gotoPage:"Ir a la página",loading:"cargando...",selectRow:"seleccione fila",showSelectedOnly:"muestra solo las filas seleccionadas"}};"auto"==config.language&&(config.language=navigator.language.substr(0,2)),config.lang=void 0!==langs[config.language]?langs[config.language]:langs.en;var selected_rows=[],totalRecords=0,filteredRecords=0,data=null===config.data?[]:config.data,fdata=data;"string"==typeof data&&(async()=>{const res=await fetch(data).then(d=>d.json());data=await res.json()})();const graphCanvasHTML=`<canvas style="width:100%;height:${config.graphHeight};" ></canvas>`;var table=document.getElementById(id)||document.body.appendChild(table=document.createElement("TABLE")),tbody=table.querySelector(":scope tbody")||table.appendChild(tbody=document.createElement("TBODY")),thead=table.querySelector(":scope thead")||table.insertBefore(thead=document.createElement("THEAD"),tbody),editinput=void 0,renderPageinfo=function(){return`<span class="page-info">${(config.page-1)*config.size+1}-${Math.min(filteredRecords,config.page*config.size)} ${config.lang.of} ${totalRecords!=filteredRecords?`${filteredRecords}/`:""}${totalRecords}</span>`},renderPaginator=function(){var rr="&#x23f5;",ll="&#x23F4;";return`\n        <ul class="pagination" >\n          <li class="page-item"><a class="page-link firstpage" title="${config.lang.first}" href="#">&#x2503;${config.rtl?rr:ll}</a></li>\n          <li class="page-item"><a class="page-link prevpage" title="${config.lang.previous}" href="#">${config.rtl?rr:ll}</a></li>\n          <li class="page-item active"><a class="page-link gotopage" title="${config.lang.gotoPage}" href="javascript:void(0)">${config.page} / ${Math.floor((filteredRecords+(config.size-1))/config.size)}</a></li>\n          <li class="page-item"><a class="page-link nextpage" title="${config.lang.next}" href="#">${config.rtl?ll:rr}</a></li>\n          <li class="page-item"><a class="page-link lastpage" title="${config.lang.last}" href="#">${config.rtl?ll:rr}&#x2503;</a></li>\n        </ul>\n      `},nextPage=function(){config.page=Math.floor(Math.min(config.page+1,(filteredRecords+config.size-1)/config.size)),render()},prevPage=function(){config.page=Math.max(1,config.page-1),render()},lastPage=function(){config.page=Math.floor((filteredRecords+config.size-1)/config.size),render()},firstPage=function(){config.page=1,render()},getSelectedItems=function(){return selected_rows};var selectRow=function(rownum,selected=!0){selected?(config.multiselect||(selected_rows=[]),selected_rows.push(data[rownum-1])):selected_rows=selected_rows.filter(x=>x.rownum!=rownum),(tbody.querySelectorAll(":scope tr.selected")||[]).forEach(e=>e.classList.remove("selected")),selected_rows.map(s=>{null!==(x=tbody.querySelector(":scope > tr[data-rownum='"+s.rownum+"']"))&&x.classList.add("selected")}),null!==tfoot&&tfoot.querySelectorAll(".selected-count").forEach(x=>x.innerText=`${getSelectedItems().length}`),(tbody.querySelectorAll(":scope tr.selected td.multiselect input.selector")||[]).forEach(e=>e.checked=!0)},redraw=function(){thead.querySelectorAll(":scope tr:not(.filter) th:not(.multiselect)").forEach((th,idx)=>{th.style.display=!1===config.columns[idx].visible?"none":"table-cell"}),thead.querySelectorAll(":scope tr.filter th:not(.multiselect)").forEach((th,idx)=>{th.style.display=!1===config.columns[idx].visible?"none":"table-cell"}),drawFooter(),render()},vv=function(item,idx){return void 0!==config.columns[idx].name?item[config.columns[idx].name]:item[idx]},vv2=function(item,idx){return void 0!==config.columns[idx].value?config.columns[idx].value(item):vv(item,idx)},ss=function(rownum,idx,v){void 0!==config.columns[idx].name?data[rownum][config.columns[idx].name]=v:data[rownum][idx]=v},chart=void 0,wrapper=this.document.createElement("DIV");wrapper.classList.add("fathgrid-wrapper"),config.rtl&&wrapper.setAttribute("dir","rtl"),table.parentNode.insertBefore(wrapper,table),thead.querySelectorAll("tr th").forEach((th,i)=>{void 0===config.columns[i]&&(config.columns[i]={}),""===th.innerText?th.innerText=config.columns[i].header||config.columns[i].name:config.columns[i].header=th.innerText});const parts={graph:`<div class="graphplaceholder">${graphCanvasHTML}</div>`,tools:`\n      ${void 0!==config.graphValues&&"function"==typeof Chart?`<nav class="fathgrid-graph-nav dropdown" id="graphs${id}"><a href="javascript:void(0)" title="Show graph">\n        <svg style="display:block-inline;width:1.5em;margin:4px;stroke-width: 0;stroke: currentColor;fill: currentColor;" viewBox="0 0 32 32" >\n        <path d="M4 28h28v4h-32v-32h4zM9 26c-1.657 0-3-1.343-3-3s1.343-3 3-3c0.088 0 0.176 0.005 0.262 0.012l3.225-5.375c-0.307-0.471-0.487-1.033-0.487-1.638 0-1.657 1.343-3 3-3s3 1.343 3 3c0 0.604-0.179 1.167-0.487 1.638l3.225 5.375c0.086-0.007 0.174-0.012 0.262-0.012 0.067 0 0.133 0.003 0.198 0.007l5.324-9.316c-0.329-0.482-0.522-1.064-0.522-1.691 0-1.657 1.343-3 3-3s3 1.343 3 3c0 1.657-1.343 3-3 3-0.067 0-0.133-0.003-0.198-0.007l-5.324 9.316c0.329 0.481 0.522 1.064 0.522 1.691 0 1.657-1.343 3-3 3s-3-1.343-3-3c0-0.604 0.179-1.167 0.487-1.638l-3.225-5.375c-0.086 0.007-0.174 0.012-0.262 0.012s-0.176-0.005-0.262-0.012l-3.225 5.375c0.307 0.471 0.487 1.033 0.487 1.637 0 1.657-1.343 3-3 3z"></path></svg>\n        </a></nav>\n        `:""}\n      ${config.selectColumns?`<nav class="fathgrid-columns-nav dropdown" id="columns${id}"><a href="javascript:void(0)">\n        <svg style="display:block-inline;width:1.5em;margin:4px;stroke-width: 0;stroke: currentColor;fill: currentColor;" viewBox="0 0 32 32" ><g transform="rotate(90 16 16)"><path d="M0 0h8v8h-8zM12 2h20v4h-20zM0 12h8v8h-8zM12 14h20v4h-20zM0 24h8v8h-8zM12 26h20v4h-20z"></path></g></svg>\n        </a><div class="dropdown-content">${config.columns.map((c,idx)=>`<a class="${!1!==c.visible?"checked":""}" data-i="${idx}" href="#">${c.header||c.name}</a>`).join(" ")}</div></nav>`:""}\n      ${config.exportable?`<nav class="fathgrid-export-nav dropdown" id="exporter${id}"><a href="javascript:void(0)">\n        <svg style="display:block-inline;width:1.5em;margin:4px;stroke-width: 0;stroke: currentColor;fill: currentColor;" viewBox="0 0 32 32" ><path d="M23 14l-8 8-8-8h5v-12h6v12zM15 22h-15v8h30v-8h-15zM28 26h-4v-2h4v2z"></path></svg>\n        </a><div class="dropdown-content"><a href="javascript:void(0)" title="${config.lang.export}" data-format="txt">TXT</a> <a href="javascript:void(0)" title="${config.lang.export}" data-format="csv">CSV</a> <a href="javascript:void(0)" title="${config.lang.export}" data-format="html">HTML</a> <a href="javascript:void(0)" title="${config.lang.export}" data-format="xls">XLS</a> ${"function"==typeof window.jsPDF?`<a href="javascript:void(0)" title="${config.lang.export}" data-format="pdf">PDF</a>`:""}</div></nav>`:""}\n      ${config.printable?`<nav class="fathgrid-print-nav dropdown printgrid${id}"><a href="javascript:void(0)" title="Print">\n        <svg style="display:block-inline;width:1.5em;margin:4px;stroke-width: 0;stroke: currentColor;fill: currentColor;" viewBox="0 0 32 32" >\n        <path d="M8 2h16v4h-16v-4z"></path>\n        <path d="M30 8h-28c-1.1 0-2 0.9-2 2v10c0 1.1 0.9 2 2 2h6v8h16v-8h6c1.1 0 2-0.9 2-2v-10c0-1.1-0.9-2-2-2zM4 14c-1.105 0-2-0.895-2-2s0.895-2 2-2 2 0.895 2 2-0.895 2-2 2zM22 28h-12v-10h12v10z"></path>        </svg>        </a></nav>\n        `:""}\n      `,info:config.pageable?`<div class="pageinfo${id}">`+renderPageinfo()+"</div>":"",table:`<div id="table-container${id}"></div>`,pager:config.pageable?`<nav class="paginator${id}">`+renderPaginator()+"</nav>":""};wrapper.innerHTML=config.template.replace(/{(\w+)}/g,(x,y)=>parts[y]),wrapper.querySelector(":scope #table-container"+id).appendChild(table),wrapper.querySelectorAll(":scope .fathgrid-columns-nav a").forEach(x=>x.addEventListener("click",(function(e){var idx,bShow;x.classList.toggle("checked"),idx=x.dataset.i,bShow=x.classList.contains("checked"),config.columns[idx].visible=bShow,redraw(),stop(e)}))),wrapper.querySelectorAll(":scope .fathgrid-graph-nav a").forEach(x=>x.addEventListener("click",(function(e){x.parentElement.classList.toggle("active"),showGraph(),stop(e)}))),wrapper.querySelectorAll(":scope .fathgrid-print-nav a").forEach(x=>x.addEventListener("click",(function(e){printGrid(),stop(e)})));var pageinfos=wrapper.querySelectorAll(`:scope .pageinfo${id}`),paginators=wrapper.querySelectorAll(`:scope .paginator${id}`),exporter=wrapper.querySelector(`#exporter${id}`);null!==exporter&&exporter.querySelectorAll(":scope a").forEach(a=>{a.addEventListener("click",(function(e){void 0!==e.srcElement.dataset.format&&downloadFile(getExportData(e.srcElement.dataset.format),"export."+e.srcElement.dataset.format)}))}),"fathgrid ".split(" ").forEach(x=>{""!==x&&table.classList.add(x)}),null===data||0===totalRecords?table.querySelectorAll(":scope tbody tr").forEach((tr,idx)=>{var row=[];tr.querySelectorAll(":scope td").forEach(td=>{row.push(td.innerText)}),row.id=void 0===tr.dataset.id?idx+1:tr.dataset.id,data.push(row)}):data=data.map((x,idx)=>(void 0===x.id&&(x.id=idx+1),x)),data=data.map((x,idx)=>(x.rownum=idx+1,x));var tfoot=table.querySelector("TFOOT"),drawFooter=function(){if(config.showFooter){if(null===tfoot?(tfoot=document.createElement("TFOOT"),table.appendChild(tfoot),tfoot.innerHTML="<tr></tr>"):tfoot.innerHTML="<tr></tr>",config.multiselect){var td=this.document.createElement("TH");td.dataset.i=-1,td.classList.add("selected-count"),tfoot.appendChild(td)}config.columns.forEach((c,idx)=>{var td=this.document.createElement("TH");td.dataset.i=idx,tfoot.appendChild(td),!1===c.visible&&(td.style.display="none"),!1===c.printable&&td.classList.add("noprint"),(c.class||"").split(" ").filter(x=>""!=x).forEach(c1=>td.classList.add(c1))})}};drawFooter();var getFilter=function(){return r=[],thead.querySelectorAll(":scope th:not(.multiselect) input, select").forEach(i=>{""!=i.value&&(r[config.columns[i.dataset.i].name]=i.value)}),r},getData=async function(){if(void 0!==config.serverURL){const parameters={page:config.page,size:config.size,search:config.q,sort:config.sort.map(i=>config.columns[Math.abs(i)-1].name).join(","),order:config.sort.map(i=>i<0?"desc":"asc"),filters:Object.keys(getFilter()).map(k=>k+"="+getFilter()[k]).join("&")};var url=config.serverURL.replace(/\${(\w+)}/g,(x,y)=>parameters[y]);const ret=await async function(){const res=await fetch(url);return totalRecords=parseInt(res.headers.get("x-total-count")),res.headers.get("Content-Range"),await config.prepareData(await res.json())}();return data=(data=Array.isArray(ret)?ret:void 0!==ret.content?ret.content:ret.data).map((x,idx)=>(x.rownum=idx+1,x)),filteredRecords=totalRecords,data}return totalRecords=data.length,fdata=data.filter(x=>{var ok=!0;return!(config.multiselect&&thead.querySelector(":scope tr.filter .selector").checked&&!selected_rows.includes(x))&&(thead.querySelectorAll(":scope th:not(.multiselect) input, select").forEach(i=>{var opts=Array.from(i.querySelectorAll(":scope option:checked"),y=>y.value);if(opts.filter(a=>""!=a).length>1){var ok2=!1;opts.forEach(y=>{""!=y&&x[i.dataset.i].includes(y)&&(ok2=!0)}),ok2||(ok=!1)}else"checkbox"===i.type?i.checked&&!isChecked(vv(x,i.dataset.i))&&(ok=!1):"color"===i.type?"#000000"!=i.value&&vv(x,i.dataset.i)!=i.value&&(ok=!1):"checkbox"===config.columns[i.dataset.i].type?""!=i.value&&vv(x,i.dataset.i)!=i.value&&(ok=!1):""!=i.value&&"number"==typeof vv(x,i.dataset.i)&&vv(x,i.dataset.i)!=i.value?ok=!1:""==i.value||"string"!=typeof vv(x,i.dataset.i)||vv(x,i.dataset.i).includes(i.value)||(ok=!1);ok&&""!=config.q&&(ok=void 0!==config.columns.find((f,ci)=>"number"==typeof vv(x,ci)?vv(x,ci)==config.q:"string"==typeof vv(x,ci)?vv(x,ci).toLowerCase().includes(config.q.toLowerCase()):vv(x,ci)==config.q))}),ok)}),filteredRecords=fdata.length,fdata.slice((config.page-1)*config.size,config.page*config.size)},_renderData=[],renderBody=function(dd=null,update_graph=!0){null===dd?dd=_renderData:_renderData=dd,[...tbody.children].forEach(x=>tbody.removeChild(x)),editinput=void 0,(config.page-1)*config.size>=filteredRecords&&(config.page=1);var gg,gtr,gtd,lastgroup=null,groupdata=[];void 0!==chart&&update_graph&&updateGraph(),dd.forEach((dr,idx)=>{"function"==typeof config.groupOn&&lastgroup!==(gg=config.groupOn(dr,idx))&&(!0===config.showGroupFooter&&null!==lastgroup&&(tbody.appendChild(gtr=document.createElement("TR")),gtr.classList.add("group-footer"),config.columns.forEach((c,i)=>{gtr.appendChild(gtd=document.createElement("TD")),gtd.style.display=!1!==c.visible?gtd.style.display:"none",!1===c.printable&&gtd.classList.add("noprint"),(c.class||"").split(" ").filter(x=>""!=x).forEach(c=>gtd.classList.add(c)),null!==(xx="function"==typeof c.groupFooter?c.groupFooter(groupdata,c.name||i,gtd,config.decimals):c.groupFooter||null)&&(gtd.innerHTML="<b>"+xx+"</b>")})),tbody.appendChild(gtr=document.createElement("TR")),gtr.appendChild(document.createElement("TD")),gtr.classList.add("group-row"),gtr.querySelector(":scope TD").setAttribute("colspan",config.columns.filter(x=>!1!==x.visible).length+(config.multiselect?1:0)),gtr.querySelector(":scope TD").innerHTML=`<b>${gg}</b>`,lastgroup=gg,groupdata=[]);var r=document.createElement("tr");if(r.dataset.id=dr.id,r.dataset.rownum=dr.rownum,"function"==typeof config.rowClass&&(cs=config.rowClass(dr,idx))&&"string"==typeof cs&&cs.split(" ").forEach(c=>""!=c?r.classList.add(c):c),getSelectedItems().includes(dr)&&r.classList.add("selected"),config.multiselect){var c=document.createElement("td");c.title=`${config.lang.selectRow}`,c.classList.add("multiselect"),c.innerHTML=`<input type="checkbox" class="selector" data-rownum="${dr.rownum}" name="select_${dr.id}" ${getSelectedItems().includes(dr)?"checked":""} />`,r.appendChild(c)}config.columns.forEach((column,col)=>{var c=document.createElement("td");!1===column.visible&&(c.style.display="none"),(column.class||"").split(" ").filter(x=>""!=x).forEach(c1=>c.classList.add(c1));var x=void 0!==column.value?column.value(dr):void 0!==column.name?dr[column.name]:dr[col];"checkbox"==column.type?(c.innerHTML=`<input type="checkbox" ${"1"==x||"true"==x||!0===x||"yes"==x||"on"==x?"checked":""} ${!1===column.editable||"function"==typeof column.editable&&!1===column.editable(dr,col+1)||0==config.editable?"disabled":""} />`,c.querySelector(":scope input[type=checkbox]").addEventListener("click",(function(e){config.onChange(dr,col,!e.srcElement.checked,e.srcElement.checked)}))):void 0!==column.html?c.innerHTML=column.html(dr):c.innerText=x,!1===column.printable&&c.classList.add("noprint"),r.appendChild(c)}),tbody.appendChild(r),void 0!==config.groupOn&&!0===config.showGroupFooter&&groupdata.push(dr)}),void 0!==config.groupOn&&!0===config.showGroupFooter&&(tbody.appendChild(gtr=document.createElement("TR")),gtr.classList.add("group-footer"),config.columns.forEach((c,i)=>{gtr.appendChild(gtd=document.createElement("TD")),gtd.style.display=!1!==c.visible?gtd.style.display:"none",(c.class||"").split(" ").filter(x=>""!=x).forEach(c1=>gtd.classList.add(c1)),!1===c.printable&&gtd.classList.add("noprint"),null!==(xx="function"==typeof c.groupFooter?c.groupFooter(groupdata,c.name||i,gtd,config.decimals):c.groupFooter||null)&&(gtd.innerHTML="<b>"+xx+"</b>")}),groupdata=[]),config.pageable&&(pageinfos.forEach(pageinfo=>pageinfo.innerHTML=renderPageinfo()),paginators.forEach(paginator=>{paginator.innerHTML=renderPaginator(),paginator.querySelectorAll(".nextpage").forEach(x=>{x.addEventListener("click",(function(e){nextPage(),stop(e)}))}),paginator.querySelectorAll(".prevpage").forEach(x=>{x.addEventListener("click",(function(e){prevPage(),stop(e)}))}),paginator.querySelectorAll(".lastpage").forEach(x=>{x.addEventListener("click",(function(e){lastPage(),stop(e)}))}),paginator.querySelectorAll(".firstpage").forEach(x=>{x.addEventListener("click",(function(e){firstPage(),stop(e)}))}),paginator.querySelectorAll(".gotopage").forEach(x=>{x.addEventListener("click",(function(e){x.innerHTML=`<input id="gotopage" style="width:3em;text-align:center;" type="number" min="1" max="${(filteredRecords+config.size-1)/config.size}" value="${config.page}"/>`;var gti=x.querySelector(":scope input");gti.focus(),gti.select(),gti.addEventListener("change",(function(e){config.page=Math.max(1,parseInt(e.srcElement.value)),stop(e),render()}))}))})})),tbody.querySelectorAll("input.selector").forEach(i=>i.addEventListener("click",(function(e){selectRow(e.srcElement.dataset.rownum,e.srcElement.checked)}))),tbody.querySelectorAll("td").forEach(x=>{x.addEventListener("click",(function(e){var tr=e.srcElement.parentElement.closest("TR");config.multiselect&&x.classList.contains("multiselect")?e.srcElement==x&&x.querySelector(":scope input.selector").click():(selectRow(tr.dataset.rownum),config.onClick(data[e.srcElement.parentElement.closest("TR").dataset.rownum-1],[...e.srcElement.parentElement.closest("TR").children].indexOf(e.srcElement.closest("TD"))+1,e.srcElement.closest("TD")))}))}),null!==tfoot&&tfoot.querySelectorAll(":scope th").forEach((td,idx)=>{void 0!==config.columns[idx].footer&&null!==(xx="function"==typeof config.columns[idx].footer?config.columns[idx].footer(fdata,config.columns[idx].name||idx,td,config.decimals):config.columns[idx].footer||null)&&(td.innerHTML=xx)}),config.onRender(),config.onInitTable(tbody)},render=function(){table.querySelectorAll(":scope tbody tr").forEach(tr=>{tr.parentNode.removeChild(tr)}),tbody.innerHTML=`<tr><td colspan="${config.columns.length+(config.multiselect?1:0)}">${config.loading||config.lang.loading}</td></tr>`,getData().then(dd=>{renderBody(dd)})},sort=function(i,desc,multisort,wantRender){var ss=config.sort;config.sort=ss.map(x=>x==i||x==-i?-x:x),multisort||(config.sort=[!0===desc||void 0!==ss.find(x=>x==i)?-i:i]),void 0===ss.find(x=>x==i||x==-i)&&multisort&&config.sort.push(!0===desc?-i:i),void 0!==config.sortBy&&(config.sort=[...config.sortBy.filter(x=>!config.sort.includes(x)),...config.sort]),data.sort((a,b)=>{for(var f=0;f<config.sort.length;f++){var i1=Math.abs(config.sort[f])-1,ds=config.sort[f]<0;if(a1="number"==typeof vv2(a,i1)?vv2(a,i1):vv2(a,i1).replace(/(<([^>]+)>)/gi,""),b1="number"==typeof vv2(b,i1)?vv2(b,i1):vv2(b,i1).replace(/(<([^>]+)>)/gi,""),a1!==b1)return(!0===ds?-1:1)*(isNaN(parseFloat(a1))?a1<b1?-1:a1>b1?1:0:a1-b1)}return 0}),data=data.map((x,idx)=>(x.rownum=idx+1,x)),null!==thead.querySelector("th.sorted")&&thead.querySelectorAll(":scope th.sorted").forEach(a=>a.classList.remove("sorted")),null!==thead.querySelector("th.sorted-desc")&&thead.querySelectorAll(":scope th.sorted-desc").forEach(a=>a.classList.remove("sorted-desc")),config.sort.forEach(x=>{thead.querySelector(":scope th:nth-child("+(Math.abs(x)+(config.multiselect?1:0))+")").classList.add(x<0?"sorted-desc":"sorted")}),!1!==wantRender&&render()};if(thead.innerHTML="",0===thead.querySelectorAll(":scope th").length){var tr=document.createElement("TR");thead.appendChild(tr),config.multiselect&&(tr.innerHTML='<th class="multiselect"></th>'),config.columns.forEach((c,i)=>{tr.appendChild(th=document.createElement("TH")),th.innerText=c.header||c.name,!1===c.visible&&(th.style.display="none"),th.dataset.name=c.name||i,!1===c.printable&&th.classList.add("noprint"),(c.class||"").split(" ").filter(x=>""!=x).forEach(c1=>th.classList.add(c1))})}if(config.sortBy!==this.undefined&&config.sortBy.map(c=>sort(c,!1,!0,!1)),config.sortable&&thead.querySelectorAll("tr th").forEach((th,i)=>{th.style.cursor="pointer",th.addEventListener("click",(function(e){sort(i+1,void 0,e.shiftKey),stop(e),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}))}),config.filterable){var r=document.createElement("TR");r.classList.add("filter"),config.multiselect&&(r.innerHTML=`<th title="${config.lang.showSelectedOnly}" class="multiselect"><input type="checkbox" title="${config.lang.showSelectedOnly}" class="selector" /></th>`),config.columns.forEach((c,idx)=>{var f=document.createElement("TH"),i=void 0;if(void 0===config.columns[idx].filterable||!1!==config.columns[idx].filterable){if(void 0!==config.columns[idx]&&config.columns[idx].filter!==this.undefined){(i=document.createElement("SELECT")).add(document.createElement("OPTION"));var ff=config.columns[idx].filter;null===ff&&(ff=[],data.forEach(v=>{ff.includes(vv(v,idx))||ff.push(vv(v,idx))}),ff.sort()),ff.forEach(v=>{var o=document.createElement("OPTION");o.innerText="object"==typeof v?v.name:v,o.value="object"==typeof v?v.value:v,i.add(o)})}else(i=document.createElement("INPUT")).setAttribute("type",void 0===config.columns[idx]?"text":config.columns[idx].type);i.style.width="100%",!1===config.columns[idx].visible&&(f.style.display="none"),i.dataset.i=idx,f.append(i)}!1===c.printable&&f.classList.add("noprint"),r.append(f)}),thead.append(r),r.querySelectorAll(":scope input, select").forEach(i=>{i.addEventListener("change",(function(e){render()}))}),config.onInitFilter(r)}var stop=function(e){e.preventDefault(),e.stopPropagation()},isChecked=function(v){return v==config.lang.yes||"yes"==v||"true"==v||!0===v||"on"==v||1==v||"1"==v},editNext=function(rownum,col){for(var r=rownum,c=col;void 0!==data[rownum-1];){col++;var column=config.columns[col-1];if(void 0!==column&&(!1!==column.editable||"function"==typeof column.editable&&!1!==column.editable(data[rownum-1],col))&&"checkbox"!==column.type)return editCell(rownum,col);col>config.columns.length&&(col=0,rownum++)}editCell(r,c)},editCell=function(rownum,col){if(config.editable){if(void 0!==editinput){var newval=editinput.value;if(!editinput.checkValidity())return editinput.classList.add("error");var old=vv(data[editinput.dataset.rownum-1],editinput.dataset.col-1);if(ss(editinput.dataset.rownum-1,editinput.dataset.col-1,newval),old!=newval&&!1===config.onChange(data[editinput.dataset.rownum-1],editinput.dataset.col,old,newval))return ss(editinput.dataset.rownum-1,editinput.dataset.col-1,old),void editinput.classList.add("error");editinput.remove(),editinput=void 0,renderBody()}var column=config.columns[col-1];if((void 0===column||!1!==column.editable&&("function"!=typeof column.editable||!1!==column.editable(data[rownum-1],col)))&&"checkbox"!==column.type){var coltype=void 0!==column&&void 0!==column.type?column.type:"text",t=vv(data[rownum-1],col-1),el=tbody.querySelector(":scope > tr[data-rownum='"+rownum+"'] td:nth-child("+(col+(config.multiselect?1:0))+")"),i=null;if(void 0!==column&&void 0!==column.listOfValues){el.innerHTML='<select style="width:100%;" id="coledit"  ></select>',i=el.querySelector(":scope #coledit");var lov=column.listOfValues;"function"==typeof lov&&(lov=lov(data[rownum-1],col,el)),lov.forEach(v=>{var o=document.createElement("OPTION");o.innerText=void 0===v.name?v:v.name,o.value=null==v.value?v:v.value,o.value==vv(data[rownum-1],col-1)&&o.setAttribute("selected","selected"),i.add(o)}),i.focus(),i.addEventListener("change",(function(e){vv(data[rownum-1],col-1)!=e.srcElement.value&&config.onChange(data[rownum-1],col,vv(data[rownum-1],col-1),e.srcElement.value)}))}else el.innerHTML="textarea"==column.type?`<textarea id="coledit" style="width:${el.clientWidth}px;height:${el.clientHeight}px" ></textarea>`:`<input type="${coltype}" ${void 0!==column.title?`title="${column.title}"`:""} ${void 0!==column.pattern?`pattern="${column.pattern}"`:""} style="width:100%;" id="coledit" value=""/>`,(i=el.querySelector(":scope #coledit")).value=t,i.focus(),i.select();i.addEventListener("click",(function(ev){ev.stopPropagation()})),i.dataset.originalvalue=t,i.dataset.rownum=rownum,i.dataset.col=col,i.addEventListener("keydown",(function(e){if(void 0!==rownum)switch(e.which){case 27:editinput=void 0,render();break;case 38:[...el.parentElement.parentElement.children].indexOf(el.parentElement)>0&&(stop(e),editCell(rownum-1,col));break;case 40:null!==el.parentElement.nextSibling&&(stop(e),editCell(rownum+1,col));break;case 37:e.shiftKey&&(stop(e),function(rownum,col){for(var r=rownum,c=col;void 0!==data[rownum-1];){--col<1&&(col=config.columns.length+1,rownum--);var column=config.columns[col-1];if(void 0!==column&&(!1!==column.editable||"function"==typeof column.editable&&!1!==column.editable(data[rownum-1],col))&&"checkbox"!==column.type)return editCell(rownum,col)}editCell(r,c)}(rownum,col));break;case 13:case 9:stop(e),editNext(rownum,col);break;case 39:e.shiftKey&&null!==el.nextSibling&&(stop(e),editNext(rownum,col))}})),editinput=i,config.onInitInput(data[rownum-1],column.name||col,el)}}},downloadFile=function(blob,filename,type="text/plain"){if("object"==typeof blob)return void blob.save(filename);const url=win.URL.createObjectURL(new Blob([blob],{type:type})),a=document.createElement("a");a.style.display="none",a.href=url,a.download=void 0===filename?"export.txt":filename,document.body.appendChild(a),a.click(),win.URL.revokeObjectURL(url)},getExportData=function(fmt){var ret="";if("txt"==fmt&&data.forEach(r=>{ret+="\n",Object.keys(r).forEach(k=>{ret+=r[k]+"\t"})}),"csv"==fmt&&(ret+="sep=,\n",data.forEach(r=>{Object.keys(r).forEach(k=>{ret+='"'+(""+r[k]).replace('"','\\"')+'",'}),ret+="\n"})),"html"!=fmt&&"xls"!=fmt||(ret+="<table><tbody>"+data.map(r=>"<tr>"+Object.keys(r).map(k=>"<td>"+r[k]+"</td>").join("")+"</tr>").join("")+"</tbody></table>"),"xls"==fmt){const parameters={title:"Export",table:ret};return'\n        <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n        <meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"/>\n        <head>\x3c!--[if gte mso 9]><xml>\n        <x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{title}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>\n        <![endif]--\x3e</head>\n        <body>{table}</body></html>'.replace(/{(\w+)}/g,(x,y)=>parameters[y])}if("pdf"==fmt){var doc=new jsPDF("p","cm","A4");doc.setFontSize(9),doc.setLineWidth(.025);var x=1,y=1,ii=0,pg=1,cw=[],cww=0;table.querySelectorAll(":scope thead tr:nth-child(1) th").forEach(x=>{cww+=x.clientWidth,cw.push(x.clientWidth)}),table.querySelectorAll(":scope thead tr:nth-child(1) th").forEach(f=>{doc.getTextWidth(f.innerText);cw[ii]&&doc.text(f.innerText,x,y,{maxWidth:cw[ii]/cww*20-.1}),x+=cw[ii++]/cww*20}),y+=.3;var lastgroup=null,groupdata=[];return data.forEach((r,idx)=>{"function"==typeof config.groupOn&&lastgroup!==(gg=config.groupOn(r,idx))&&(doc.setFontType("bold"),!0===config.showGroupFooter&&null!==lastgroup&&(doc.line(1,y-.4,20,y-.4),config.columns.forEach((c,ic)=>{doc.text(""+("function"==typeof c.groupFooter?c.groupFooter(groupdata,c.name||ic,null,config.decimals):void 0===c.groupFooter?"":c.groupFooter),x,y,{}),x+=cw[ic]/cww*20}),doc.line(1,y+.2,20,y+.2),y+=.5),doc.text(gg,1,y,{maxWidth:cw[ii]/cww*20-.1}),doc.setFontType("normal"),y+=.5,x=1,lastgroup=gg,groupdata=[]),ii=0;var lines=0;config.columns.forEach((c,ic)=>{var ct=vv2(r,ic);if(void 0!==ct){var w=doc.getTextWidth(ct);cw[ii]&&(doc.text(""+ct,x,y,{maxWidth:cw[ii]/cww*20-.1}),lines=Math.max(lines,w/(cw[ii]/cww*20-.1)))}x+=cw[ii++]/cww*20}),x=1,y+=.3*(1+Math.floor(lines+.9999)),doc.line(1,y-.35,20,y-.35),y>28&&(doc.text(""+pg++,10,29),doc.addPage(),y=1,doc.setLineWidth(.025),doc.line(1,y-.35,20,y-.35)),void 0!==config.groupOn&&!0===config.showGroupFooter&&groupdata.push(r)}),doc.text(""+pg++,10,29),doc.setFontType("bold"),!0===config.showGroupFooter&&null!==lastgroup&&(doc.line(1,y-.4,20,y-.4),x=1,config.columns.forEach((c,ic)=>{doc.text(""+("function"==typeof c.groupFooter?c.groupFooter(groupdata,c.name||ic,null,config.decimals):void 0===c.groupFooter?"":c.groupFooter),x,y,{}),x+=cw[ic]/cww*20}),doc.line(1,y+.2,20,y+.2)),doc.line(1,y-.4,20,y-.4),doc}return ret};const colors=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(153, 102, 255)","rgb(75, 192, 192)","rgb(201, 203, 207)"];var updateGraph=function(){if(void 0!==chart){var dd=config.graphValues(fdata),ci=0;chart.data={labels:dd.labels,datasets:Array.isArray(dd.values[0])?dd.values.map((x,idx)=>({label:dd.title[idx],data:x,borderWidth:1,backgroundColor:colors[ci],borderColor:colors[ci++],fill:!1})):[{label:dd.title,data:dd.values,borderWidth:1,backgroundColor:colors[ci],borderColor:colors[ci++]}]},chart.update({duration:0})}},showGraph=function(){var dd=config.graphValues(fdata);void 0!==chart&&(chart.destroy(),chart=void 0,wrapper.querySelector(".graphplaceholder").innerHTML=graphCanvasHTML);var ctx=wrapper.querySelector(":scope .graphplaceholder canvas");if("block"!=wrapper.querySelector(":scope .graphplaceholder").style.display){wrapper.querySelector(":scope .graphplaceholder").style.display="block";var ci=0;chartConfig={type:config.graphType,data:{labels:dd.labels,datasets:Array.isArray(dd.values[0])?dd.values.map((x,idx)=>({label:dd.title[idx],data:x,borderWidth:1,backgroundColor:colors[ci],borderColor:colors[ci++],fill:!1})):[{label:dd.title,data:dd.values,borderWidth:1,backgroundColor:colors[ci],borderColor:colors[ci++]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}},chart=new Chart(ctx,chartConfig)}else wrapper.querySelector(":scope .graphplaceholder").style.display="none"},printGrid=function(){var _page=config.page,_size=config.size;config.page=1,config.size=fdata.length,getData().then(dd=>{renderBody(dd,!1);var WinPrint=window.open();WinPrint.document.write(`<!doctype html><html lang="en"><head>${document.head.innerHTML}<style>table .noprint {display:none}</style></head><body>`),WinPrint.document.write(`<h1>${(document.querySelector("h1")||document.querySelector("TITLE")).innerText}</h1><div class="fathgrid-wrapper">`),WinPrint.document.write((void 0!==chart?wrapper.querySelector(":scope .graphplaceholder").innerHTML:"")+table.parentElement.innerHTML),WinPrint.document.write("</div></body></html>"),WinPrint.document.close(),WinPrint.setTimeout(()=>{void 0!==chart&&WinPrint.document.querySelector("canvas")&&WinPrint.document.querySelector("canvas").getContext("2d").drawImage(wrapper.querySelector("canvas"),0,0),WinPrint.focus(),WinPrint.print(),WinPrint.close()},1e3),config.page=_page,config.size=_size,render()})};return render(),{id:id,render:render,nextPage:nextPage,prevPage:prevPage,lastPage:lastPage,firstPage:firstPage,sort:sort,setPageSize:function(x){config.size=parseInt(x),config.page=1,render()},getPageSize:function(){return config.size},getSort:function(){return config.sort},setSort:function(ss){"number"==typeof ss&&(ss=[ss]),config.sort=[],ss.map(x=>sort(Math.abs(x),x<0,!0)),render()},filter:function(idx,str){thead.querySelector(".filter th:nth-child("+(idx+(config.multiselect?1:0))+")").querySelector(":scope input, select").value=str,render()},getFilter:getFilter,editCell:editCell,getData:function(){return data.map(x=>x)},setData:function(newdata){data=[],newdata.map((x,idx)=>{x.rownum=idx+1,data.push(x)}),render()},getExportData:getExportData,export:function(fmt="txt",filename="export"){downloadFile(getExportData(fmt),filename+"."+fmt,"xls"==fmt?"application/vnd.ms-excel;base64,":"text/plain")},search:function(q){if(void 0===q)return config.q;config.q=q,render()},getSelectedItem:function(){return selected_rows.length?selected_rows[0]:null},getSelectedItems:getSelectedItems,setServerURL:function(u){config.serverURL=u,render()},wrapperEl:wrapper,showSubgrid:function(tt,_html=""){var a=tbody.querySelectorAll(":scope tr.subgrid"),el=tbody.querySelector(":scope > tr.selected");el.insertAdjacentHTML("afterend",`<tr class="subgrid"><td colspan="${config.columns.length+(config.multiselect?1:0)}" >${_html}</td></tr>`),el.nextSibling.querySelector(":scope td").appendChild(tt.wrapperEl),a.forEach(x=>x.parentElement.removeChild(x))},selectRow:selectRow,insertRow:function(rownum,item){null===rownum&&(rownum=data.length+1),data.splice(rownum-1,0,item),data.map((x,idx)=>(x.rownum=idx+1,x)),render()},deleteRow:function(rownum){data.splice(rownum-1,1),data.map((item,idx)=>(item.rownum=idx+1,item)),render()},refresh:renderBody}},win.FathGrid.SUM=function(data,cname,el,_decimals=2){return data.map(x=>parseFloat(x[cname].replace("$",""))).reduce((x,s)=>x+s,0).toFixed(_decimals)},win.FathGrid.AVG=function(data,cname,el,_decimals=2){return data.length?(data.map(x=>parseFloat(x[cname].replace("$",""))).reduce((p,c)=>p+c,0)/data.length).toFixed(_decimals):null},win.FathGrid.MIN=function(data,cname,el,_decimals=2){var y=data[0][cname];return"number"==typeof y?Math.min(...data.map(x=>x[cname])).toFixed(_decimals):(data.map(x=>y=y<x[cname]?y:x[cname]),y)},win.FathGrid.MAX=function(data,cname,el,_decimals=2){var y=data[0][cname];return"number"==typeof y?Math.max(...data.map(x=>x[cname])).toFixed(_decimals):(data.map(x=>y=y>x[cname]?y:x[cname]),y)}}("undefined"!=typeof window?window:this);